<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdvisorGPT 대시보드</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Mulish&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="main-dashboard-container">
        <!-- Left Sidebar -->
        <aside class="sidebar left-sidebar">
            <div class="profile-section">
                <!-- ID 추가 및 기본 src 설정 -->
                <img src="../image/user_profile_default.png" alt="User Profile" class="profile-pic" id="sidebar-profile-pic">
                <p class="user-nickname" id="sidebar-username">User</p> <!-- ID는 이미 존재 -->
            </div>
            <nav class="menu-section">
                <ul id="sidebar-menu"> <!-- 사이드바 메뉴에 ID 추가 (활성 상태 제어용) -->
                    <li class="active"><a href="../Main_Page/main.html"><img src="../image/icon_my_today.png" alt="" class="menu-icon"> 나의 오늘</a></li>
                    <li><a href="../Health_Report/health_report.html"><img src="../image/icon_health_report.png" alt="" class="menu-icon"> 건강 리포트</a></li>
                    <li><a href="../GPT_Chatbot/gpt_chatbot.html"><img src="../image/icon_gpt_chatbot.png" alt="" class="menu-icon"> GPT Chatbot</a></li>
                    <li><a href="../Settings_Page/settings.html"><img src="../image/icon_settings.png" alt="" class="menu-icon"> 설정</a></li>
                </ul>
            </nav>
            <div class="logo-section">
                <img src="../image/AdvisorGPT_Logo_big.png" alt="AdvisorGPT Logo" class="advisor-logo">
            </div>
        </aside>

        <!-- Center Content -->
        <main class="main-content">
            <header class="welcome-header">
                <!-- h1 태그 내용 변경 및 span 태그 id 추가 -->
                <h1>환영합니다, <span class="username-highlight" id="main-username-placeholder">User</span>님!</h1>
            </header>
            <section class="health-summary">
                <div class="summary-title-container">
                    <h2>오늘의 건강 점수는...</h2>
                </div>
                <div class="scores-container">
                    <div class="main-score-block">
                        <span id="health-score-value">--</span>
                        <span class="unit">점</span>
                    </div>
                    <div class="detailed-scores-block">
                        <div class="score-item">
                            <img src="../image/icon_sleep_moon_right.png" alt="Sleep" class="score-icon">
                            <div class="score-text">
                                <span class="score-label">수면</span>
                                <span id="display-sleep-hours">--</span> 시간 <span id="display-sleep-mins">--</span> 분
                            </div>
                        </div>
                        <div class="score-item">
                            <img src="../image/icon_meal_bowl_center.png" alt="Meal" class="score-icon">
                            <div class="score-text">
                                <span class="score-label">식사</span>
                                <span id="display-meal-kcal">--</span> kcal
                            </div>
                        </div>
                        <div class="score-item">
                            <img src="../image/icon_exercise_dumbbell_center.png" alt="Exercise" class="score-icon">
                            <div class="score-text">
                                <span class="score-label">운동</span>
                                <span id="display-exercise-hours">--</span> 시간 <span id="display-exercise-mins">--</span> 분
                            </div>
                        </div>
                    </div>
                    <div class="stress-score-block">
                        <img src="../image/icon_stress_head_center.png" alt="Stress Score Icon" class="score-icon-large">
                        <div class="stress-score-text">
                            <span class="score-label">스트레스 지수</span>
                            <span class="score-label-small">낮을수록 긍정적</span>
                        </div>
                        <div class="stress-score-value">
                            <span id="stress-score-value">--</span>
                            <span class="unit">점</span>
                        </div>
                    </div>  
                </div>
            </section>
            <section class="daily-feedback">
                <h2><img src="../image/icon_daily_feedback.png" alt="" class="score-icon-feedback"> 오늘의 요약 & 피드백</h2>
                <div class="feedback-grid">
                    <div class="feedback-box" id="feedback-physical-analysis">
                        <h3><img src="../image/icon_physical.png" alt="" class="feedback-icon"> 신체적 분석</h3>
                        <p id="physical-analysis-text">오늘의 기록을 입력하시면 AI가 분석을 제공합니다.</p>
                    </div>
                    <div class="feedback-box" id="feedback-physical-tips">
                        <h3><img src="../image/icon_tip.png" alt="" class="feedback-icon"> 피드백 & 팁</h3>
                        <p id="physical-tips-text">AI의 피드백과 팁이 여기에 표시됩니다.</p>
                    </div>
                    <div class="feedback-box" id="feedback-mental-analysis">
                        <h3><img src="../image/icon_mental.png" alt="" class="feedback-icon"> 정신적 분석</h3>
                        <p id="mental-analysis-text">AI의 정신적 분석이 여기에 표시됩니다.</p>
                    </div>
                    <div class="feedback-box" id="feedback-mental-tips">
                        <h3><img src="../image/icon_tip.png" alt="" class="feedback-icon"> 피드백 & 팁</h3>
                        <p id="mental-tips-text">AI의 추가적인 피드백과 팁이 여기에 표시됩니다.</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Right Sidebar (이전과 동일) -->
        <aside class="sidebar right-sidebar">
            <!-- ... (우측 사이드바 내용 이전과 동일) ... -->
            <h3 class="right-sidebar-title">오늘의 기록</h3>
            <div class="date-display">
                <img src="../image/icon_calendar.png" alt="Calendar" class="sidebar-icon">
                <span id="current-date"></span>
            </div>
            <form id="daily-record-form">
            <div class="form-group">
                <label><img src="../image/icon_sleep_moon_right.png" alt="Sleep" class="sidebar-icon"> 수면 시간</label>
                <div class="time-inputs">
                    <input type="number" id="sleep-hours" placeholder="시간" min="0" max="23">
                    <span>시간</span>
                    <input type="number" id="sleep-mins" placeholder="분" min="0" max="59">
                    <span>분</span>
                </div>
            </div>
            <div class="form-group">
                <label><img src="../image/icon_breakfast_right.png" alt="Breakfast" class="sidebar-icon"> 식사량</label>
                <label>아침  </label>
                <div class="kcal-input">
                    <input type="number" id="meal-breakfast" placeholder="0" min="0">
                    <span>kcal</span>
                </div>
            </div>
            <div class="form-group">
                <label>점심</label>
                <div class="kcal-input">
                    <input type="number" id="meal-lunch" placeholder="0" min="0">
                    <span>kcal</span>
                </div>
            </div>
            <div class="form-group">
                <label>저녁</label>
                <div class="kcal-input">
                    <input type="number" id="meal-dinner" placeholder="0" min="0">
                    <span>kcal</span>
                </div>
            </div>
            <div class="form-group">
                <label><img src="../image/icon_strength_right.png" alt="Strength" class="sidebar-icon"> 근력 운동</label>
                <div class="time-inputs">
                    <input type="number" id="exercise-strength-hours" placeholder="시간" min="0" max="23">
                    <span>시간</span>
                    <input type="number" id="exercise-strength-mins" placeholder="분" min="0" max="59">
                    <span>분</span>
                </div>
            </div>
            <div class="form-group">
                <label><img src="../image/icon_cardio_right.png" alt="Cardio" class="sidebar-icon"> 유산소 운동</label>
                <div class="time-inputs">
                    <input type="number" id="exercise-cardio-hours" placeholder="시간" min="0" max="23">
                    <span>시간</span>
                    <input type="number" id="exercise-cardio-mins" placeholder="분" min="0" max="59">
                    <span>분</span>
                </div>
            </div>
            <div class="form-group">
                <label><img src="../image/icon_mood_right.png" alt="Mood" class="sidebar-icon"> 기분 / 스트레스</label>
                <textarea id="mood-stress-text" maxlength="500" placeholder="오늘의 기분이나 스트레스에 대해 적어주세요."></textarea>
                <small class="char-counter" id="char-counter">0/500 자</small>
            </div>
            <button type="submit" class="submit-button">기록 완료</button>
        </form>
        </aside>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- 로그인한 사용자 정보 로드 및 UI 업데이트 ---
    const loggedInUserEmail = localStorage.getItem('loggedInUserEmail');
    const sidebarProfilePic = document.getElementById('sidebar-profile-pic');
    const sidebarUsername = document.getElementById('sidebar-username');
    const mainUsernamePlaceholder = document.getElementById('main-username-placeholder');
    const defaultProfilePicPath = '../image/user_profile_default.png';

    if (loggedInUserEmail) {
        // localStorage에서 사용자 전체 정보 가져오기 (선택적, 닉네임과 프로필만 필요하면 개별 키 사용)
        // const users = JSON.parse(localStorage.getItem('advisorGptUsers')) || [];
        // const currentUser = users.find(user => user.email === loggedInUserEmail);

        const nickname = localStorage.getItem('userNickname') || 'User'; // 개별 키에서 닉네임 가져오기
        const profilePic = localStorage.getItem('userProfileImage') || defaultProfilePicPath; // 개별 키에서 프로필 사진 가져오기

        if (sidebarProfilePic) {
            sidebarProfilePic.src = profilePic;
            sidebarProfilePic.alt = nickname + " 프로필";
        }
        if (sidebarUsername) {
            sidebarUsername.textContent = nickname;
        }
        if (mainUsernamePlaceholder) {
            mainUsernamePlaceholder.textContent = nickname;
            // mainUsernamePlaceholder.style.color = '#3377DD'; // CSS로 처리하는 것이 더 좋음
        }
    } else {
        // 로그인하지 않은 사용자에 대한 처리 (예: 로그인 페이지로 리디렉션)
        // alert("로그인이 필요한 서비스입니다.");
        // window.location.href = '../Advisor_login/index.html'; 
        // 또는 기본값(User, 기본 프로필) 유지
    }

    // --- 사이드바 활성 메뉴 설정 ---
    const currentPage = "main.html"; // 현재 페이지 파일명
    const sidebarLinks = document.querySelectorAll('#sidebar-menu li a');
    sidebarLinks.forEach(link => {
        link.parentElement.classList.remove('active');
        const linkHref = link.getAttribute('href');
        if (linkHref && linkHref.includes(currentPage)) {
            link.parentElement.classList.add('active');
        }
    });


    // --- 기존 스크립트 내용 (날짜, 기록 폼 처리 등) ---
    const dateElement = document.getElementById('current-date');
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const day = String(today.getDate()).padStart(2, '0');
    if (dateElement) dateElement.textContent = `${year} / ${month} / ${day}`;

    const moodStressText = document.getElementById('mood-stress-text');
    const charCounter = document.getElementById('char-counter');
    if (moodStressText && charCounter) {
        moodStressText.addEventListener('input', function() {
            const currentLength = moodStressText.value.length;
            charCounter.textContent = `${currentLength} /500 자`;
        });
    }

    const form = document.getElementById('daily-record-form');
    if (form) {
        form.addEventListener('submit', function(event) {
            event.preventDefault(); 

            const sleepHours = parseInt(document.getElementById('sleep-hours').value) || 0;
            const sleepMins = parseInt(document.getElementById('sleep-mins').value) || 0;
            if(document.getElementById('display-sleep-hours')) document.getElementById('display-sleep-hours').textContent = sleepHours;
            if(document.getElementById('display-sleep-mins')) document.getElementById('display-sleep-mins').textContent = sleepMins;

            const bfKcal = parseInt(document.getElementById('meal-breakfast').value) || 0;
            const lunchKcal = parseInt(document.getElementById('meal-lunch').value) || 0;
            const dinnerKcal = parseInt(document.getElementById('meal-dinner').value) || 0;
            const totalKcal = bfKcal + lunchKcal + dinnerKcal;
            if(document.getElementById('display-meal-kcal')) document.getElementById('display-meal-kcal').textContent = totalKcal;

            const strengthHours = parseInt(document.getElementById('exercise-strength-hours').value) || 0;
            const strengthMins = parseInt(document.getElementById('exercise-strength-mins').value) || 0;
            const cardioHours = parseInt(document.getElementById('exercise-cardio-hours').value) || 0;
            const cardioMins = parseInt(document.getElementById('exercise-cardio-mins').value) || 0;
            
            let totalExerciseHours = strengthHours + cardioHours;
            let totalExerciseMins = strengthMins + cardioMins;
            totalExerciseHours += Math.floor(totalExerciseMins / 60);
            totalExerciseMins = totalExerciseMins % 60;
            if(document.getElementById('display-exercise-hours')) document.getElementById('display-exercise-hours').textContent = totalExerciseHours;
            if(document.getElementById('display-exercise-mins')) document.getElementById('display-exercise-mins').textContent = totalExerciseMins;

            if(document.getElementById('health-score-value')) document.getElementById('health-score-value').textContent = '82'; // 고정값
            if(document.getElementById('stress-score-value')) document.getElementById('stress-score-value').textContent = '75'; // 고정값
            
            if(document.getElementById('physical-analysis-text')) document.getElementById('physical-analysis-text').textContent = "AI 분석: 오늘의 기록을 바탕으로 신체적 상태를 분석 중입니다...";
            if(document.getElementById('physical-tips-text')) document.getElementById('physical-tips-text').textContent = "AI 피드백: 건강한 습관을 위한 맞춤형 팁을 생성 중입니다...";
            if(document.getElementById('mental-analysis-text')) document.getElementById('mental-analysis-text').textContent = "AI 정신 분석: 오늘의 기분/스트레스 내용을 바탕으로 분석 중입니다...";
            if(document.getElementById('mental-tips-text')) document.getElementById('mental-tips-text').textContent = "AI 정신 피드백: 마음 건강을 위한 조언을 준비 중입니다...";

            alert('오늘의 기록이 중앙 패널에 반영되었습니다!');
        });
    }
});
</script>
</body>
</html>
